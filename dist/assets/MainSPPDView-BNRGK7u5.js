import{e as V,g as m,f as E,c as f,a as t,F as H,s as U,t as s,b as N,w as $,o as h,j as v,v as p,u as y,d as F,p as O,h as A,S as J}from"./index-Zf5tl8Hn.js";import{_ as q}from"./ModalItem-CsntKK8A.js";import{T as o}from"./ToastAlert-DwSx-M0G.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const r=_=>(O("data-v-8b4ea17f"),_=_(),A(),_),G={class:"card"},K={class:"card-body"},R=r(()=>t("h4",{class:"card-title mb-4"},"List SPPD",-1)),Y=["disabled"],Q={class:"table-responsive"},W={class:"table table-striped table-bordered"},X=r(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No"),t("th",{scope:"col"},"Tanggal SPPD"),t("th",{scope:"col"},"Tujuan"),t("th",{scope:"col"},"Tgl Berangkat"),t("th",{scope:"col"},"Tgl Pulang"),t("th",{scope:"col"},"Lama Penugasan"),t("th",{scope:"col",class:"text-center"},"Action")])],-1)),Z={key:0},tt=["textContent"],at=["textContent"],et=["textContent"],nt=["textContent"],lt=["textContent"],ot=["textContent"],st={class:"text-center"},it=["onClick"],rt=["onClick"],ut={key:1},ct={colspan:"6",class:"text-center"},dt={class:"mb-3"},gt=r(()=>t("label",{for:"tgl",class:"form-label"},"Tanggal SPPD",-1)),mt=["min"],ft={class:"mb-3"},ht=r(()=>t("label",{for:"uraian",class:"form-label"},"Tujuan",-1)),vt={class:"mb-3"},pt=r(()=>t("label",{for:"tglBerangkat",class:"form-label"},"Tanggal Keberangkatan",-1)),_t=["min"],bt={class:"mb-3"},Pt=r(()=>t("label",{for:"tglPulang",class:"form-label"},"Tanggal Pulang",-1)),Dt=["min","disabled"],Tt={class:"mb-3"},kt=r(()=>t("label",{for:"lamaPenugasan",class:"form-label"},"Lama Penugasan (Hari)",-1)),i="sppd",Bt={__name:"MainSPPDView",setup(_){const u=V(),a=m({tgl:"",tujuan:"",tglBerangkat:"",tglPulang:"",lamaPenugasan:""}),T=()=>{a.value={tgl:"",tujuan:"",tglBerangkat:"",tglPulang:"",lamaPenugasan:""}},S=()=>{T(),c.value={title:"Tambah Data SPPD",confirmButtonText:"Simpan",actionType:"add",data:a.value}},w=l=>{a.value={...l},c.value={title:"Edit Data SPPD",confirmButtonText:"Update",actionType:"edit",data:a.value}},c=m({title:"Tambah Data SPPD",confirmButtonText:"Simpan",actionType:"add",data:{}}),g=m([]),b=m(!0);E(async()=>{g.value=await u.fetchData(i),b.value=!b.value,B()});const C=()=>a.value.tgl?a.value.tujuan.trim()?a.value.tglBerangkat?a.value.tglPulang?new Date(a.value.tglPulang)<=new Date(a.value.tglBerangkat)?(o.fire({icon:"error",title:"Tanggal pulang harus lebih besar dari tanggal keberangkatan"}),!1):a.value.lamaPenugasan?!0:(o.fire({icon:"error",title:"Lama penugasan harus diisi"}),!1):(o.fire({icon:"error",title:"Tanggal pulang harus diisi"}),!1):(o.fire({icon:"error",title:"Tanggal keberangkatan harus diisi"}),!1):(o.fire({icon:"error",title:"Tujuan harus diisi"}),!1):(o.fire({icon:"error",title:"Tanggal SPPD harus diisi"}),!1),k=async({actionType:l})=>{if(C())try{const n=JSON.parse(JSON.stringify(a.value));l==="add"?(await u.addItem(i,n),o.fire({icon:"success",title:"Data SPPD berhasil ditambahkan"})):l==="edit"&&(await u.updateData(i,"id",n.id,n),o.fire({icon:"success",title:"Data SPPD berhasil diubah"})),g.value=await u.fetchData(i),T()}catch(n){console.error("Error:",n),o.fire({icon:"error",title:"Terjadi kesalahan"})}},j=async l=>{if((await J.fire({title:"Hapus Data SPPD?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red"})).isConfirmed)try{await u.deleteItemById(i,l)?(o.fire({icon:"success",title:`Data ${i} berhasil dihapus`}),g.value=await u.fetchData(i)):o.fire({icon:"error",title:"Gagal menghapus data"})}catch(e){console.error("Error deleting item:",e),o.fire({icon:"error",title:"Terjadi kesalahan saat menghapus data"})}},B=()=>{const l=document.getElementById("uraian");l&&(l.style.height="auto",l.style.height=`${l.scrollHeight}px`)},I=()=>{a.value.tglBerangkat?(d.value=new Date(a.value.tglBerangkat),d.value.setDate(d.value.getDate()+1),d.value=d.value.toISOString().split("T")[0],a.value.tglPulang&&new Date(a.value.tglPulang)<=new Date(a.value.tglBerangkat)&&(a.value.tglPulang="",a.value.lamaPenugasan="")):(a.value.tglPulang="",a.value.lamaPenugasan="")},L=()=>{if(a.value.tglBerangkat&&a.value.tglPulang){const l=new Date(a.value.tglBerangkat),n=new Date(a.value.tglPulang),e=Math.abs(n-l),P=Math.ceil(e/(1e3*60*60*24));a.value.lamaPenugasan=P}else a.value.lamaPenugasan=""},D=l=>{if(!l)return"";const n={day:"numeric",month:"long",year:"numeric"};return new Date(l).toLocaleDateString("id-ID",n)},x=new Date().toISOString().split("T")[0],d=m("");return(l,n)=>(h(),f("div",G,[t("div",K,[R,t("button",{type:"button",class:"btn btn-primary mb-4",onClick:S,disabled:b.value,"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop"}," Tambah Data ",8,Y),t("div",Q,[t("table",W,[X,g.value.length>0?(h(),f("tbody",Z,[(h(!0),f(H,null,U(g.value,(e,P)=>(h(),f("tr",{key:P},[t("td",{textContent:s(P+1)},null,8,tt),t("td",{textContent:s(D(e.tgl))},null,8,at),t("td",{textContent:s(e.tujuan)},null,8,et),t("td",{textContent:s(D(e.tglBerangkat))},null,8,nt),t("td",{textContent:s(D(e.tglPulang))},null,8,lt),t("td",{textContent:s(e.lamaPenugasan+" Hari")},null,8,ot),t("td",st,[t("button",{class:"btn-danger btn me-2 btn-sm",onClick:M=>j(e.id)}," Hapus ",8,it),t("button",{"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",class:"btn-sm btn-warning btn",onClick:M=>w(e)}," Edit ",8,rt)])]))),128))])):(h(),f("tbody",ut,[t("tr",null,[t("td",ct,s(b.value?"Loading Data...":"Data masih kosong"),1)])]))])])]),N(q,{title:c.value.title,confirmButtonText:c.value.confirmButtonText,actionType:c.value.actionType,data:c.value.data,onConfirm:k},{body:$(()=>[t("form",{onSubmit:F(k,["prevent"])},[t("div",dt,[gt,v(t("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>a.value.tgl=e),type:"date",min:y(x),class:"form-control",id:"tgl"},null,8,mt),[[p,a.value.tgl]])]),t("div",ft,[ht,v(t("textarea",{id:"uraian","onUpdate:modelValue":n[1]||(n[1]=e=>a.value.tujuan=e),class:"form-control",rows:"1",ref:"autoResizeTextarea",onInput:B},null,544),[[p,a.value.tujuan]])]),t("div",vt,[pt,v(t("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>a.value.tglBerangkat=e),type:"date",min:y(x),class:"form-control",id:"tglBerangkat",onChange:I},null,40,_t),[[p,a.value.tglBerangkat]])]),t("div",bt,[Pt,v(t("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>a.value.tglPulang=e),type:"date",min:d.value,class:"form-control",id:"tglPulang",disabled:!a.value.tglBerangkat,onChange:L},null,40,Dt),[[p,a.value.tglPulang]])]),t("div",Tt,[kt,v(t("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>a.value.lamaPenugasan=e),type:"text",class:"form-control",id:"lamaPenugasan",readonly:""},null,512),[[p,a.value.lamaPenugasan]])])],32)]),_:1},8,["title","confirmButtonText","actionType","data"])]))}},Ct=z(Bt,[["__scopeId","data-v-8b4ea17f"]]);export{Ct as default};
