import{D as la,q as oa,u as sa,z as na,f as ia,h,g as ra,A as w,r as ua,c as u,a,b as ca,w as da,m as b,t as v,l as n,v as i,F as A,y as H,x,n as pa,S as _,B as T,o as c}from"./index-DYrpQ_Z4.js";import{T as ma}from"./ToastAlert-BqTsMoFM.js";const ha={"aria-label":"breadcrumb"},va={class:"breadcrumb"},ba={class:"breadcrumb-item"},ga=a("li",{class:"breadcrumb-item","aria-current":"page"},"Manage",-1),_a=a("h1",{class:"text-dark fw-bold mb-2"},"Manage Delegasi",-1),fa=a("b",null,"No ST ",-1),ya={class:"mb-4"},ka={key:0,class:"badge text-bg-primary fs-1"},Da={key:1,class:"badge text-bg-danger fs-1"},Pa={key:0,class:"card"},wa=a("h5",{class:"card-header text-dark"},"Pilih SPPD dan Pegawai",-1),xa={class:"card-body"},Ta={class:"accordion accordion-flush",id:"accordionFlushExample"},Sa={class:"accordion-item"},Ca=a("h2",{class:"accordion-header"},[a("button",{class:"accordion-button px-0 bg-transparent text-dark fw-bold collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#flush-collapseTwo","aria-expanded":"false","aria-controls":"flush-collapseTwo"},[a("span",{class:"rounded-circle fs-1 text-bg-primary me-2 d-flex justify-content-center align-items-center",style:{width:"25px",height:"25px"}},"1"),b(" Pilih Nomor SPPD "),a("sup",{class:"text-info ms-1"},"*Opsional")])],-1),Na={id:"flush-collapseTwo",class:"accordion-collapse collapse","data-bs-parent":"#accordionFlushExample"},Ra={class:"accordion-body px-0"},Va={key:0,class:"list-group"},Ba=["onClick"],Ma={key:0},Ua=a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",class:"icon icon-tabler icons-tabler-filled icon-tabler-circle-check text-success"},[a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),a("path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z"})],-1),La=[Ua],Ia={key:1,class:"text-center"},Aa={class:"accordion-item"},Ha=a("h2",{class:"accordion-header"},[a("button",{class:"accordion-button px-0 bg-transparent text-dark fw-bold collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#flush-collapseThree","aria-expanded":"false","aria-controls":"flush-collapseThree"},[a("span",{class:"rounded-circle fs-1 text-bg-primary me-2 d-flex justify-content-center align-items-center",style:{width:"25px",height:"25px"}},"2"),b(" Pilih Pegawai ")])],-1),ja={id:"flush-collapseThree",class:"accordion-collapse collapse","data-bs-parent":"#accordionFlushExample"},Ea={class:"accordion-body px-0"},Ja={key:0,class:"list-group"},Ka=["onClick"],za={key:0},Oa=a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",class:"icon icon-tabler icons-tabler-filled icon-tabler-circle-check text-success"},[a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),a("path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z"})],-1),$a=[Oa],Fa={key:1,class:"text-center"},qa={key:1,class:"card mt-4",ref:"reviewSection"},Ya=a("h5",{class:"card-header text-dark"},"Review Pilihan",-1),Ga={class:"card-body"},Qa=a("strong",null,"NO ST",-1),Wa=a("strong",null,"NO SPPD",-1),Xa=a("strong",null,"Nama Pegawai",-1),Za={class:"mt-4"},ae=a("h5",{class:"mb-3"},"Input Biaya Sarana dan Prasarana",-1),ee={class:"card mb-3"},te=a("div",{class:"card-header"},"Hotel/Penginapan",-1),le={class:"card-body"},oe={class:"mb-3"},se=a("label",{for:"hotelName",class:"form-label"},"Nama Hotel/Penginapan",-1),ne={class:"mb-3"},ie=a("label",{for:"hotelVoucher",class:"form-label"},"No Voucher/Invoice Hotel",-1),re={class:"card mb-3"},ue=a("div",{class:"card-header"},"Transportasi",-1),ce={class:"card-body"},de={class:"mb-3"},pe=a("label",{for:"transportationType",class:"form-label"},"Jenis Transportasi",-1),me={class:"mb-3"},he=a("label",{for:"bookingCode",class:"form-label"},"Kode Booking",-1),ve={class:"mb-3"},be=a("label",{for:"seatNumber",class:"form-label"},"Nomor Kursi",-1),ge={class:"mb-3"},_e=a("label",{for:"pricePP",class:"form-label"},"Harga PP",-1),fe={class:"mb-3"},ye=a("label",{for:"priceDeparture",class:"form-label"},"Harga Tiket Berangkat",-1),ke={class:"mb-3"},De=a("label",{for:"priceReturn",class:"form-label"},"Harga Tiket Pulang",-1),Pe={class:"mb-3"},we=a("label",{for:"sumTransport",class:"form-label"},"Jumlah Uang Transport",-1),xe={class:"card mb-3"},Te=a("div",{class:"card-header"},"Penginapan",-1),Se={class:"card-body"},Ce={class:"mb-3"},Ne=a("label",{for:"rate",class:"form-label"},"Tarif Satuan Penginapan",-1),Re={class:"mb-3"},Ve=a("label",{for:"numDays",class:"form-label"},"Jumlah Hari/Malam",-1),Be={class:"mb-3"},Me=a("label",{for:"totalAccommodation",class:"form-label"},"Jumlah Harga Penginapan",-1),Ue={class:"card mb-3"},Le=a("div",{class:"card-header"},"Uang Harian",-1),Ie={class:"card-body"},Ae={class:"mb-3"},He=a("label",{for:"dailyRate",class:"form-label"},"Satuan Uang Harian (Rp)",-1),je={class:"mb-3"},Ee=a("label",{for:"dailyNumDays",class:"form-label"},"Jumlah Hari",-1),Je={class:"mb-3"},Ke=a("label",{for:"totalDaily",class:"form-label"},"Total Uang Harian",-1),ze={class:"card mb-3"},Oe=a("div",{class:"card-header"},"Biaya Lainnya (bila ada)",-1),$e={class:"card-body"},Fe={class:"mb-3"},qe=a("label",{for:"uraian",class:"form-label"},"Keterangan",-1),Ye={class:"mb-3"},Ge=a("label",{for:"dailyNumDays",class:"form-label"},"Jumlah",-1),Qe={key:2,class:"card"},We={class:"card-header d-flex flex-wrap justify-content-between"},Xe=a("span",{class:"text-dark"}," Rincian Delegasi ",-1),Ze={class:"card-body"},at={class:"table-responsive"},et={class:"table table-striped table-bordered"},tt=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"NO SPPD"),a("th",{scope:"col"},"Nama Pegawai"),a("th",{scope:"col",class:"text-center"},"Action")])],-1),lt=["textContent"],ot=["textContent"],st={class:"text-center"},nt=["onClick"],dt={__name:"ManageDelegasiViews",setup(it){const{proxy:p}=la(),$=oa(),j=sa(),F=na(),k=ia(),C=h([]),N=h([]),R=h([]),r=h({}),D=h(!0),E=F.manageIdDelegasi,V=async()=>{const o=await k.findData("delegasiPegawai",E);if(!o)return $.push({name:"delegasi"});C.value=await k.fetchData("sppd"),N.value=await k.fetchData("pegawai"),R.value=await k.fetchData("delegasiPegawai"),r.value=o};ra(async()=>{try{await V(),D.value=!D.value,setTimeout(()=>{document.body.removeAttribute("style")},2e3)}catch(o){console.error("Error fetching data from IDB:",o),D.value=!D.value}});const B=h(""),M=h(""),P=h(null),f=h(null),q=()=>{P.value=null,f.value=null,l.value={hotelName:"",hotelVoucher:"",transportationType:"",bookingCode:"",seatNumber:"",pricePP:0,priceDeparture:0,priceReturn:0,totalPrice:0,rate:0,numDays:0,totalAccommodation:0,dailyRate:0,dailyNumDays:0,totalDaily:0,biayaLainnyaKeterangan:"",biayaLainnyaJumlah:0}},J=w(()=>C.value.length?C.value.filter(o=>!R.value.some(e=>{var s;return(s=e.relation)==null?void 0:s.some(d=>{var m;return((m=d.noSPPD)==null?void 0:m.noSPPD)===o.noSPPD})})).filter(o=>o.noSPPD.toLowerCase().includes(B.value.toLowerCase())):[]),K=w(()=>!N.value.length||!r.value?[]:N.value.filter(o=>!R.value.some(s=>{var d;return s.noST.noST===r.value.noST.noST&&((d=s.relation)==null?void 0:d.some(m=>m.pegawai.namaPegawai===o.namaPegawai))})).filter(o=>o.namaPegawai.toLowerCase().includes(M.value.toLowerCase()))),Y=o=>{P.value=o},G=o=>{f.value=o},l=h({hotelName:"",hotelVoucher:"",transportationType:"",bookingCode:"",seatNumber:"",pricePP:0,priceDeparture:0,priceReturn:0,totalPrice:0,rate:0,numDays:0,totalAccommodation:0,dailyRate:0,dailyNumDays:0,totalDaily:0,biayaLainnyaKeterangan:"",biayaLainnyaJumlah:0}),S=h(null),Q=()=>{S.value.style.height="auto",S.value.style.height=`${S.value.scrollHeight}px`},W=async()=>{try{if(!(await _.fire({title:"Apakah data sudah betul?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red",backdrop:!0,allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)return;const e=await X();if(e){const s=p.unformatRupiah(e);aa();let m={...{totalSemuaDana:s,...l.value},noSPPD:T(P.value)??{noSPPD:""},pegawai:T(f.value)};const t=await Z();t&&(m={...m,...t});let g={};r.value&&r.value.relation?g={...T(r.value),relation:[...T(r.value.relation),m]}:g={relation:[m]},console.log({storeRawData:g}),await k.updateData("delegasiPegawai","id",E,g),await V(),q(),r.value.relation.length?(_.fire({icon:"success",title:"Data Berhasil Ditambahkan",html:`NO ST <b>${j.params.noST}</b> telah berhasil ditambahkan Data Delegasinya`}),y.value=!y.value):_.fire({icon:"success",title:"Delegasi Tugas telah Aktif",html:`NO ST <b>${j.params.noST}</b> telah berhasil di Aktifkan`})}}catch(o){console.error("Terjadi kesalahan:",o)}},X=async()=>{const{value:o}=await _.fire({title:"Total Dana Yang Diterima",input:"text",inputValue:p.formatRupiah(0),inputValidator:e=>{if(!e)return"Input tidak boleh kosong";if(isNaN(p.unformatRupiah(e)))return"Input harus berupa angka"},showCancelButton:!0,confirmButtonText:"Lanjut",cancelButtonText:"Batal",cancelButtonColor:"red",backdrop:!0,allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{_.getInput().addEventListener("input",s=>{const d=s.target.value.replace(/[^0-9,]/g,"");s.target.value=p.formatRupiah(p.unformatRupiah(d))})}});return o},Z=async()=>{const{value:o}=await _.fire({title:"Informasi Lanjuttan!",html:`
      <input id="input1" class="swal2-input" type="text" placeholder="Jumlah Pengembalian">
      <input id="input2" class="swal2-input" type="text" placeholder="Nomor Billing">
      <input id="input3" class="swal2-input" type="text" placeholder="NTPN">
    `,focusConfirm:!1,preConfirm:()=>{const e=document.getElementById("input1").value,s=document.getElementById("input2").value,d=document.getElementById("input3").value;return!e||!s||!d?(_.showValidationMessage("Semua bidang harus diisi!"),!1):isNaN(p.unformatRupiah(e))?(_.showValidationMessage("Jumlah Kembalian harus berisikan angka !"),!1):{jumlahPengembalian:e,nomorBilling:s,ntpn:d}},showCancelButton:!0,confirmButtonText:"Simpan",cancelButtonText:"Lewati Saja",backdrop:!0,allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{document.getElementById("input1").addEventListener("input",s=>{const d=s.target.value.replace(/[^0-9,]/g,"");s.target.value=p.formatRupiah(p.unformatRupiah(d))})}});return o};function z(o,e,s){const d=e*s;return p.formatRupiah(d)}const U=w(()=>{const o=l.value.pricePP+l.value.priceDeparture+l.value.priceReturn;return p.formatRupiah(o)}),L=w(()=>z(l.value.totalAccommodation,l.value.rate,l.value.numDays)),I=w(()=>z(l.value.totalDaily,l.value.dailyRate,l.value.dailyNumDays));function aa(){l.value.totalPrice=p.unformatRupiah(U.value),l.value.totalAccommodation=p.unformatRupiah(L.value),l.value.totalDaily=p.unformatRupiah(I.value)}const y=h(!1),ea=w(()=>{var o;return(o=r.value.relation)!=null&&o.length?!!y.value:!0}),ta=async o=>{try{if(r.value.relation){console.log("Data sebelum penghapusan:",r.value),r.value.relation.splice(o,1),console.log("Data setelah penghapusan:",r.value);const e=await k.updateData("delegasiPegawai","id",r.value.id,T(r.value));await V(),console.log("Data yang diupdate di IndexedDB:",e),ma.fire({icon:"success",title:"Data berhasil dihapus"})}else console.error("Index tidak valid atau data tidak ditemukan")}catch(e){console.error("Terjadi kesalahan saat menghapus data:",e)}};return(o,e)=>{var d,m;const s=ua("router-link");return c(),u("div",null,[a("nav",ha,[a("ol",va,[a("li",ba,[ca(s,{to:{name:"delegasi"}},{default:da(()=>[b("Delegasi Pegawai")]),_:1})]),ga])]),_a,a("h5",null,[fa,b(" "+v(o.$route.params.noST),1)]),a("div",ya,[b(" Status : "),(d=r.value.relation)!=null&&d.length?(c(),u("span",ka,"Aktif")):(c(),u("span",Da,"Non Aktif"))]),ea.value?(c(),u("div",Pa,[wa,a("div",xa,[a("div",Ta,[a("div",Sa,[Ca,a("div",Na,[a("div",Ra,[n(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>B.value=t),class:"form-control mb-3",type:"text",placeholder:"Cari SPPD..."},null,512),[[i,B.value]]),J.value.length?(c(),u("ul",Va,[(c(!0),u(A,null,H(J.value,t=>(c(),u("li",{key:t.id,class:"list-group-item d-flex justify-content-between align-items-center",onClick:g=>Y(t),style:{cursor:"pointer"}},[b(v(t.noSPPD)+" ",1),P.value===t?(c(),u("span",Ma,La)):x("",!0)],8,Ba))),128))])):(c(),u("div",Ia,v(D.value?"Loading":"Data SPPD masih kosong"),1))])])]),a("div",Aa,[Ha,a("div",ja,[a("div",Ea,[n(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>M.value=t),class:"form-control mb-3",type:"text",placeholder:"Cari Pegawai..."},null,512),[[i,M.value]]),K.value.length?(c(),u("ul",Ja,[(c(!0),u(A,null,H(K.value,t=>(c(),u("li",{key:t.id,class:"list-group-item d-flex justify-content-between align-items-center",onClick:g=>G(t),style:{cursor:"pointer"}},[b(v(t.namaPegawai)+" ",1),f.value===t?(c(),u("span",za,$a)):x("",!0)],8,Ka))),128))])):(c(),u("div",Fa,v(D.value?"Loading":"Data Pegawai masih kosong"),1))])])])])])])):x("",!0),f.value?(c(),u("div",qa,[Ya,a("div",Ga,[a("p",null,[Qa,b(" : "+v(o.$route.params.noST),1)]),a("p",null,[Wa,b(" : "+v(P.value?P.value.noSPPD:"Belum Ada"),1)]),a("p",null,[Xa,b(" : "+v(f.value?f.value.namaPegawai:"Belum Ada"),1)]),a("div",Za,[ae,a("div",ee,[te,a("div",le,[a("div",oe,[se,n(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.hotelName=t),type:"text",class:"form-control",id:"hotelName",placeholder:"Masukkan nama hotel/penginapan"},null,512),[[i,l.value.hotelName]])]),a("div",ne,[ie,n(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.hotelVoucher=t),type:"text",class:"form-control",id:"hotelVoucher",placeholder:"Masukkan no voucher/invoice hotel"},null,512),[[i,l.value.hotelVoucher]])])])]),a("div",re,[ue,a("div",ce,[a("div",de,[pe,n(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.transportationType=t),type:"text",class:"form-control",id:"transportationType",placeholder:"Masukkan jenis transportasi"},null,512),[[i,l.value.transportationType]])]),a("div",me,[he,n(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.bookingCode=t),type:"text",class:"form-control",id:"bookingCode",placeholder:"Masukkan kode booking"},null,512),[[i,l.value.bookingCode]])]),a("div",ve,[be,n(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.seatNumber=t),type:"text",class:"form-control",id:"seatNumber",placeholder:"Masukkan nomor kursi"},null,512),[[i,l.value.seatNumber]])]),a("div",ge,[_e,n(a("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.pricePP=t),type:"number",class:"form-control",id:"pricePP",placeholder:"Masukkan harga PP"},null,512),[[i,l.value.pricePP]])]),a("div",fe,[ye,n(a("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.priceDeparture=t),type:"number",class:"form-control",id:"priceDeparture",placeholder:"Masukkan harga tiket berangkat"},null,512),[[i,l.value.priceDeparture]])]),a("div",ke,[De,n(a("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.priceReturn=t),type:"number",class:"form-control",id:"priceReturn",placeholder:"Masukkan harga tiket pulang"},null,512),[[i,l.value.priceReturn]])]),a("div",Pe,[we,n(a("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>U.value=t),type:"text",class:"form-control",id:"sumTransport",readonly:""},null,512),[[i,U.value]])])])]),a("div",xe,[Te,a("div",Se,[a("div",Ce,[Ne,n(a("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.rate=t),type:"number",class:"form-control",id:"rate",placeholder:"Masukkan tarif satuan penginapan"},null,512),[[i,l.value.rate]])]),a("div",Re,[Ve,n(a("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.numDays=t),type:"number",class:"form-control",id:"numDays",placeholder:"Masukkan jumlah hari/malam"},null,512),[[i,l.value.numDays]])]),a("div",Be,[Me,n(a("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>L.value=t),type:"text",class:"form-control",id:"totalAccommodation",readonly:"",placeholder:"Masukkan jumlah harga penginapan"},null,512),[[i,L.value]])])])]),a("div",Ue,[Le,a("div",Ie,[a("div",Ae,[He,n(a("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.dailyRate=t),type:"number",class:"form-control",id:"dailyRate",placeholder:"Masukkan satuan uang harian"},null,512),[[i,l.value.dailyRate]])]),a("div",je,[Ee,n(a("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.dailyNumDays=t),type:"number",class:"form-control",id:"dailyNumDays",placeholder:"Masukkan jumlah hari"},null,512),[[i,l.value.dailyNumDays]])]),a("div",Je,[Ke,n(a("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>I.value=t),type:"text",class:"form-control",id:"totalDaily",readonly:"",placeholder:"Masukkan total uang harian"},null,512),[[i,I.value]])])])]),a("div",ze,[Oe,a("div",$e,[a("div",Fe,[qe,n(a("textarea",{id:"uraian","onUpdate:modelValue":e[17]||(e[17]=t=>l.value.biayaLainnyaKeterangan=t),class:"form-control",placeholder:"Isikan Keterangan Biaya Lainnya disini...",rows:"1",ref_key:"autoResizeTextarea",ref:S,onInput:Q},null,544),[[i,l.value.biayaLainnyaKeterangan]])]),a("div",Ye,[Ge,n(a("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.biayaLainnyaJumlah=t),type:"number",class:"form-control",id:"dailyNumDays",placeholder:"Masukkan jumlah hari"},null,512),[[i,l.value.biayaLainnyaJumlah]])])])]),a("button",{type:"button",onClick:W,class:"btn-save mt-3"},"Save")])])],512)):x("",!0),(m=r.value.relation)!=null&&m.length?(c(),u("div",Qe,[a("h5",We,[Xe,a("button",{class:pa([`btn-${y.value?"danger":"primary"} btn`]),onClick:e[19]||(e[19]=t=>y.value=!y.value)},v(y.value?"Batal":"Tambah Data"),3)]),a("div",Ze,[a("div",at,[a("table",et,[tt,a("tbody",null,[(c(!0),u(A,null,H(r.value.relation,(t,g)=>{var O;return c(),u("tr",{key:g},[a("td",{textContent:v((O=t.noSPPD)==null?void 0:O.noSPPD)},null,8,lt),a("td",{textContent:v(t.pegawai.namaPegawai)},null,8,ot),a("td",st,[a("button",{onClick:rt=>ta(g),class:"btn-danger btn me-2 btn-sm"}," Hapus ",8,nt)])])}),128))])])])])])):x("",!0)])}}};export{dt as default};
