import{D as ea,q as ta,u as la,z as oa,f as sa,h as p,g as na,A as y,r as ia,c as r,a,b as ra,w as ua,m as v,t as h,l as n,v as i,F as A,y as I,x as D,n as ca,S as _,B as S,o as u}from"./index-Z_fhCoxB.js";const da={"aria-label":"breadcrumb"},pa={class:"breadcrumb"},ma={class:"breadcrumb-item"},ha=a("li",{class:"breadcrumb-item","aria-current":"page"},"Manage",-1),va=a("h1",{class:"text-dark fw-bold mb-2"},"Manage Delegasi",-1),ba=a("b",null,"No ST ",-1),_a={class:"mb-4"},ga={key:0,class:"badge text-bg-primary fs-1"},fa={key:1,class:"badge text-bg-danger fs-1"},ya={key:0,class:"card"},ka=a("h5",{class:"card-header text-dark"},"Pilih SPPD dan Pegawai",-1),Pa={class:"card-body"},wa={class:"accordion accordion-flush",id:"accordionFlushExample"},Da={class:"accordion-item"},xa=a("h2",{class:"accordion-header"},[a("button",{class:"accordion-button px-0 bg-transparent text-dark fw-bold collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#flush-collapseTwo","aria-expanded":"false","aria-controls":"flush-collapseTwo"},[a("span",{class:"rounded-circle fs-1 text-bg-primary me-2 d-flex justify-content-center align-items-center",style:{width:"25px",height:"25px"}},"1"),v(" Pilih Nomor SPPD "),a("sup",{class:"text-info ms-1"},"*Opsional")])],-1),Ta={id:"flush-collapseTwo",class:"accordion-collapse collapse","data-bs-parent":"#accordionFlushExample"},Sa={class:"accordion-body px-0"},Ca={key:0,class:"list-group"},Na=["onClick"],Ra={key:0},Va=a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",class:"icon icon-tabler icons-tabler-filled icon-tabler-circle-check text-success"},[a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),a("path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z"})],-1),Ba=[Va],Ma={key:1,class:"text-center"},Ua={class:"accordion-item"},La=a("h2",{class:"accordion-header"},[a("button",{class:"accordion-button px-0 bg-transparent text-dark fw-bold collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#flush-collapseThree","aria-expanded":"false","aria-controls":"flush-collapseThree"},[a("span",{class:"rounded-circle fs-1 text-bg-primary me-2 d-flex justify-content-center align-items-center",style:{width:"25px",height:"25px"}},"2"),v(" Pilih Pegawai ")])],-1),Aa={id:"flush-collapseThree",class:"accordion-collapse collapse","data-bs-parent":"#accordionFlushExample"},Ia={class:"accordion-body px-0"},Ha={key:0,class:"list-group"},Ea=["onClick"],ja={key:0},Ja=a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",class:"icon icon-tabler icons-tabler-filled icon-tabler-circle-check text-success"},[a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),a("path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z"})],-1),Ka=[Ja],za={key:1,class:"text-center"},Oa={key:1,class:"card mt-4",ref:"reviewSection"},$a=a("h5",{class:"card-header text-dark"},"Review Pilihan",-1),Fa={class:"card-body"},qa=a("strong",null,"NO ST",-1),Ya=a("strong",null,"NO SPPD",-1),Ga=a("strong",null,"Nama Pegawai",-1),Qa={class:"mt-4"},Wa=a("h5",{class:"mb-3"},"Input Biaya Sarana dan Prasarana",-1),Xa={class:"card mb-3"},Za=a("div",{class:"card-header"},"Hotel/Penginapan",-1),ae={class:"card-body"},ee={class:"mb-3"},te=a("label",{for:"hotelName",class:"form-label"},"Nama Hotel/Penginapan",-1),le={class:"mb-3"},oe=a("label",{for:"hotelVoucher",class:"form-label"},"No Voucher/Invoice Hotel",-1),se={class:"card mb-3"},ne=a("div",{class:"card-header"},"Transportasi",-1),ie={class:"card-body"},re={class:"mb-3"},ue=a("label",{for:"transportationType",class:"form-label"},"Jenis Transportasi",-1),ce={class:"mb-3"},de=a("label",{for:"bookingCode",class:"form-label"},"Kode Booking",-1),pe={class:"mb-3"},me=a("label",{for:"seatNumber",class:"form-label"},"Nomor Kursi",-1),he={class:"mb-3"},ve=a("label",{for:"pricePP",class:"form-label"},"Harga PP",-1),be={class:"mb-3"},_e=a("label",{for:"priceDeparture",class:"form-label"},"Harga Tiket Berangkat",-1),ge={class:"mb-3"},fe=a("label",{for:"priceReturn",class:"form-label"},"Harga Tiket Pulang",-1),ye={class:"mb-3"},ke=a("label",{for:"sumTransport",class:"form-label"},"Jumlah Uang Transport",-1),Pe={class:"card mb-3"},we=a("div",{class:"card-header"},"Penginapan",-1),De={class:"card-body"},xe={class:"mb-3"},Te=a("label",{for:"rate",class:"form-label"},"Tarif Satuan Penginapan",-1),Se={class:"mb-3"},Ce=a("label",{for:"numDays",class:"form-label"},"Jumlah Hari/Malam",-1),Ne={class:"mb-3"},Re=a("label",{for:"totalAccommodation",class:"form-label"},"Jumlah Harga Penginapan",-1),Ve={class:"card mb-3"},Be=a("div",{class:"card-header"},"Uang Harian",-1),Me={class:"card-body"},Ue={class:"mb-3"},Le=a("label",{for:"dailyRate",class:"form-label"},"Satuan Uang Harian (Rp)",-1),Ae={class:"mb-3"},Ie=a("label",{for:"dailyNumDays",class:"form-label"},"Jumlah Hari",-1),He={class:"mb-3"},Ee=a("label",{for:"totalDaily",class:"form-label"},"Total Uang Harian",-1),je={class:"card mb-3"},Je=a("div",{class:"card-header"},"Biaya Lainnya (bila ada)",-1),Ke={class:"card-body"},ze={class:"mb-3"},Oe=a("label",{for:"uraian",class:"form-label"},"Keterangan",-1),$e={class:"mb-3"},Fe=a("label",{for:"dailyNumDays",class:"form-label"},"Jumlah",-1),qe={key:2,class:"card"},Ye={class:"card-header d-flex flex-wrap justify-content-between"},Ge=a("span",{class:"text-dark"}," Rincian Delegasi ",-1),Qe={class:"card-body"},We={class:"table-responsive"},Xe={class:"table table-striped table-bordered"},Ze=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"NO SPPD"),a("th",{scope:"col"},"Nama Pegawai"),a("th",{scope:"col",class:"text-center"},"Action")])],-1),at=["textContent"],et=["textContent"],tt=a("td",{class:"text-center"},[a("button",{class:"btn-danger btn me-2 btn-sm"},"Hapus"),a("button",{class:"btn-sm btn-warning me-2 btn"},"Edit")],-1),st={__name:"ManageDelegasiViews",setup(lt){const{proxy:c}=ea(),z=ta(),O=la(),$=oa(),k=sa(),C=p([]),N=p([]),R=p([]),m=p({}),g=p(!0),H=$.manageIdDelegasi,E=async()=>{const o=await k.findData("delegasiPegawai",H);if(!o)return z.push({name:"delegasi"});C.value=await k.fetchData("sppd"),N.value=await k.fetchData("pegawai"),R.value=await k.fetchData("delegasiPegawai"),m.value=o};na(async()=>{try{await E(),g.value=!g.value,setTimeout(()=>{document.body.removeAttribute("style")},2e3)}catch(o){console.error("Error fetching data from IDB:",o),g.value=!g.value}});const V=p(""),B=p(""),f=p(null),b=p(null),F=()=>{f.value=null,b.value=null,l.value={hotelName:"",hotelVoucher:"",transportationType:"",bookingCode:"",seatNumber:"",pricePP:0,priceDeparture:0,priceReturn:0,totalPrice:0,rate:0,numDays:0,totalAccommodation:0,dailyRate:0,dailyNumDays:0,totalDaily:0,biayaLainnyaKeterangan:"",biayaLainnyaJumlah:0}},j=y(()=>C.value.length?C.value.filter(o=>!R.value.some(t=>{var s;return(s=t.relation)==null?void 0:s.some(e=>{var d;return((d=e.noSPPD)==null?void 0:d.noSPPD)===o.noSPPD})})).filter(o=>o.noSPPD.toLowerCase().includes(V.value.toLowerCase())):[]),J=y(()=>!N.value.length||!m.value?[]:N.value.filter(o=>!R.value.some(s=>{var e;return s.noST.noST===m.value.noST.noST&&((e=s.relation)==null?void 0:e.some(d=>d.pegawai.namaPegawai===o.namaPegawai))})).filter(o=>o.namaPegawai.toLowerCase().includes(B.value.toLowerCase()))),q=o=>{f.value=o},Y=o=>{b.value=o},l=p({hotelName:"",hotelVoucher:"",transportationType:"",bookingCode:"",seatNumber:"",pricePP:0,priceDeparture:0,priceReturn:0,totalPrice:0,rate:0,numDays:0,totalAccommodation:0,dailyRate:0,dailyNumDays:0,totalDaily:0,biayaLainnyaKeterangan:"",biayaLainnyaJumlah:0}),x=p(null),G=()=>{x.value.style.height="auto",x.value.style.height=`${x.value.scrollHeight}px`},Q=async()=>{try{if(!(await _.fire({title:"Apakah data sudah betul?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red",backdrop:!0,allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)return;const t=await W();if(t){const s=c.unformatRupiah(t);Z();let d={...{totalSemuaDana:s,...l.value},noSPPD:S(f.value)??{noSPPD:""},pegawai:S(b.value)};const w=await X();w&&(d={...d,...w});let T={};m.value&&m.value.relation?T={...S(m.value),relation:[...S(m.value.relation),d]}:T={relation:[d]},console.log({storeRawData:T}),await k.updateData("delegasiPegawai","id",H,T),await E(),F(),_.fire({icon:"success",title:"Delegasi Tugas telah Aktif",html:`NO ST <b>${O.params.noST}</b> telah berhasil di Aktifkan`})}}catch(o){console.error("Terjadi kesalahan:",o)}},W=async()=>{const{value:o}=await _.fire({title:"Total Dana Yang Diterima",input:"text",inputValue:c.formatRupiah(0),inputValidator:t=>{if(!t)return"Input tidak boleh kosong";if(isNaN(c.unformatRupiah(t)))return"Input harus berupa angka"},showCancelButton:!0,confirmButtonText:"Lanjut",cancelButtonText:"Batal",cancelButtonColor:"red",backdrop:!0,allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{_.getInput().addEventListener("input",s=>{const e=s.target.value.replace(/[^0-9,]/g,"");s.target.value=c.formatRupiah(c.unformatRupiah(e))})}});return o},X=async()=>{const{value:o}=await _.fire({title:"Informasi Lanjuttan!",html:`
      <input id="input1" class="swal2-input" type="text" placeholder="Jumlah Pengembalian">
      <input id="input2" class="swal2-input" type="text" placeholder="Nomor Billing">
      <input id="input3" class="swal2-input" type="text" placeholder="NTPN">
    `,focusConfirm:!1,preConfirm:()=>{const t=document.getElementById("input1").value,s=document.getElementById("input2").value,e=document.getElementById("input3").value;return!t||!s||!e?(_.showValidationMessage("Semua bidang harus diisi!"),!1):isNaN(c.unformatRupiah(t))?(_.showValidationMessage("Jumlah Kembalian harus berisikan angka !"),!1):{jumlahPengembalian:t,nomorBilling:s,ntpn:e}},showCancelButton:!0,confirmButtonText:"Simpan",cancelButtonText:"Lewati Saja",backdrop:!0,allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{document.getElementById("input1").addEventListener("input",s=>{const e=s.target.value.replace(/[^0-9,]/g,"");s.target.value=c.formatRupiah(c.unformatRupiah(e))})}});return o};function K(o,t,s){const e=t*s;return c.formatRupiah(e)}const M=y(()=>{const o=l.value.pricePP+l.value.priceDeparture+l.value.priceReturn;return c.formatRupiah(o)}),U=y(()=>K(l.value.totalAccommodation,l.value.rate,l.value.numDays)),L=y(()=>K(l.value.totalDaily,l.value.dailyRate,l.value.dailyNumDays));function Z(){l.value.totalPrice=c.unformatRupiah(M.value),l.value.totalAccommodation=c.unformatRupiah(U.value),l.value.totalDaily=c.unformatRupiah(L.value)}const P=p(!1),aa=y(()=>"relation"in m.value?!!P.value:!0);return(o,t)=>{const s=ia("router-link");return u(),r("div",null,[a("nav",da,[a("ol",pa,[a("li",ma,[ra(s,{to:{name:"delegasi"}},{default:ua(()=>[v("Delegasi Pegawai")]),_:1})]),ha])]),va,a("h5",null,[ba,v(" "+h(o.$route.params.noST),1)]),a("div",_a,[v(" Status : "),"relation"in m.value?(u(),r("span",ga,"Aktif")):(u(),r("span",fa,"Non Aktif"))]),aa.value?(u(),r("div",ya,[ka,a("div",Pa,[a("div",wa,[a("div",Da,[xa,a("div",Ta,[a("div",Sa,[n(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),class:"form-control mb-3",type:"text",placeholder:"Cari SPPD..."},null,512),[[i,V.value]]),j.value.length?(u(),r("ul",Ca,[(u(!0),r(A,null,I(j.value,e=>(u(),r("li",{key:e.id,class:"list-group-item d-flex justify-content-between align-items-center",onClick:d=>q(e),style:{cursor:"pointer"}},[v(h(e.noSPPD)+" ",1),f.value===e?(u(),r("span",Ra,Ba)):D("",!0)],8,Na))),128))])):(u(),r("div",Ma,h(g.value?"Loading":"Data SPPD masih kosong"),1))])])]),a("div",Ua,[La,a("div",Aa,[a("div",Ia,[n(a("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>B.value=e),class:"form-control mb-3",type:"text",placeholder:"Cari Pegawai..."},null,512),[[i,B.value]]),J.value.length?(u(),r("ul",Ha,[(u(!0),r(A,null,I(J.value,e=>(u(),r("li",{key:e.id,class:"list-group-item d-flex justify-content-between align-items-center",onClick:d=>Y(e),style:{cursor:"pointer"}},[v(h(e.namaPegawai)+" ",1),b.value===e?(u(),r("span",ja,Ka)):D("",!0)],8,Ea))),128))])):(u(),r("div",za,h(g.value?"Loading":"Data Pegawai masih kosong"),1))])])])])])])):D("",!0),b.value?(u(),r("div",Oa,[$a,a("div",Fa,[a("p",null,[qa,v(" : "+h(o.$route.params.noST),1)]),a("p",null,[Ya,v(" : "+h(f.value?f.value.noSPPD:"Belum Ada"),1)]),a("p",null,[Ga,v(" : "+h(b.value?b.value.namaPegawai:"Belum Ada"),1)]),a("div",Qa,[Wa,a("div",Xa,[Za,a("div",ae,[a("div",ee,[te,n(a("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.hotelName=e),type:"text",class:"form-control",id:"hotelName",placeholder:"Masukkan nama hotel/penginapan"},null,512),[[i,l.value.hotelName]])]),a("div",le,[oe,n(a("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.hotelVoucher=e),type:"text",class:"form-control",id:"hotelVoucher",placeholder:"Masukkan no voucher/invoice hotel"},null,512),[[i,l.value.hotelVoucher]])])])]),a("div",se,[ne,a("div",ie,[a("div",re,[ue,n(a("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.transportationType=e),type:"text",class:"form-control",id:"transportationType",placeholder:"Masukkan jenis transportasi"},null,512),[[i,l.value.transportationType]])]),a("div",ce,[de,n(a("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.bookingCode=e),type:"text",class:"form-control",id:"bookingCode",placeholder:"Masukkan kode booking"},null,512),[[i,l.value.bookingCode]])]),a("div",pe,[me,n(a("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.seatNumber=e),type:"text",class:"form-control",id:"seatNumber",placeholder:"Masukkan nomor kursi"},null,512),[[i,l.value.seatNumber]])]),a("div",he,[ve,n(a("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.pricePP=e),type:"number",class:"form-control",id:"pricePP",placeholder:"Masukkan harga PP"},null,512),[[i,l.value.pricePP]])]),a("div",be,[_e,n(a("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.value.priceDeparture=e),type:"number",class:"form-control",id:"priceDeparture",placeholder:"Masukkan harga tiket berangkat"},null,512),[[i,l.value.priceDeparture]])]),a("div",ge,[fe,n(a("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.value.priceReturn=e),type:"number",class:"form-control",id:"priceReturn",placeholder:"Masukkan harga tiket pulang"},null,512),[[i,l.value.priceReturn]])]),a("div",ye,[ke,n(a("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>M.value=e),type:"text",class:"form-control",id:"sumTransport",readonly:""},null,512),[[i,M.value]])])])]),a("div",Pe,[we,a("div",De,[a("div",xe,[Te,n(a("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.value.rate=e),type:"number",class:"form-control",id:"rate",placeholder:"Masukkan tarif satuan penginapan"},null,512),[[i,l.value.rate]])]),a("div",Se,[Ce,n(a("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>l.value.numDays=e),type:"number",class:"form-control",id:"numDays",placeholder:"Masukkan jumlah hari/malam"},null,512),[[i,l.value.numDays]])]),a("div",Ne,[Re,n(a("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>U.value=e),type:"text",class:"form-control",id:"totalAccommodation",readonly:"",placeholder:"Masukkan jumlah harga penginapan"},null,512),[[i,U.value]])])])]),a("div",Ve,[Be,a("div",Me,[a("div",Ue,[Le,n(a("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>l.value.dailyRate=e),type:"number",class:"form-control",id:"dailyRate",placeholder:"Masukkan satuan uang harian"},null,512),[[i,l.value.dailyRate]])]),a("div",Ae,[Ie,n(a("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>l.value.dailyNumDays=e),type:"number",class:"form-control",id:"dailyNumDays",placeholder:"Masukkan jumlah hari"},null,512),[[i,l.value.dailyNumDays]])]),a("div",He,[Ee,n(a("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>L.value=e),type:"text",class:"form-control",id:"totalDaily",readonly:"",placeholder:"Masukkan total uang harian"},null,512),[[i,L.value]])])])]),a("div",je,[Je,a("div",Ke,[a("div",ze,[Oe,n(a("textarea",{id:"uraian","onUpdate:modelValue":t[17]||(t[17]=e=>l.value.biayaLainnyaKeterangan=e),class:"form-control",placeholder:"Isikan Keterangan Biaya Lainnya disini...",rows:"1",ref_key:"autoResizeTextarea",ref:x,onInput:G},null,544),[[i,l.value.biayaLainnyaKeterangan]])]),a("div",$e,[Fe,n(a("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.value.biayaLainnyaJumlah=e),type:"number",class:"form-control",id:"dailyNumDays",placeholder:"Masukkan jumlah hari"},null,512),[[i,l.value.biayaLainnyaJumlah]])])])]),a("button",{type:"button",onClick:Q,class:"btn-save mt-3"},"Save")])])],512)):D("",!0),"relation"in m.value?(u(),r("div",qe,[a("h5",Ye,[Ge,a("button",{class:ca([`btn-${P.value?"danger":"primary"} btn`]),onClick:t[19]||(t[19]=e=>P.value=!P.value)},h(P.value?"Batal":"Tambah Data"),3)]),a("div",Qe,[a("div",We,[a("table",Xe,[Ze,a("tbody",null,[(u(!0),r(A,null,I(m.value.relation,(e,d)=>{var w;return u(),r("tr",{key:d},[a("td",{textContent:h((w=e.noSPPD)==null?void 0:w.noSPPD)},null,8,at),a("td",{textContent:h(e.pegawai.namaPegawai)},null,8,et),tt])}),128))])])])])])):D("",!0)])}}};export{st as default};
